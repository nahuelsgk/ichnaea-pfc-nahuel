\chapter{Disseny}
\label{cha:dessign}

En aquest cap\'{i}tol veurem els patrons de dissenys emprats i les tecnologies usades. Tamb\'{e} descriurem les interf\'{i}cies d'usuari m\'{e}s complexa.


\section{Esquema general l\`{o}gic arquitect\'{o}nic del sistema}
La figura \ref{fig:archsoftware} \'{e}s un esquema dels components logics del sistema on:

\begin{figure}[H]
  \includegraphics[scale=0.5]{img/design/ArchitectureSoftware.png}
  \caption{Arquitectura del sistema}
  \label{fig:archsoftware}
\end{figure}

\begin{itemize}
\item \textit{Ichnaea Web Application \& Services}: \'{e}s el \textit{core} de la aplicaci\'{o} i dels serveis HTTP.
\item Servidor de correu \'{e}s el servidor SMTP per enviar correus electr\`{o}nics als usuaris.
\item Productor-Cua-Consumidor \'{e}s el sistema de cues. Expliquem el paradigma al cap\'{i}tol \ref{sec:queue_system_overview}. La funci\'{o} \'{e}s gestionar els inicis, fluxos i finals d'execucions de Ichnaea.
\item La base de dades \'{e}s on es guarden els continguts i models de dades i resultats.
\end{itemize}

\section{Patr\'{o} de disseny}
Per la implementaci\`{o} del sistema web s'han usat un disseny per capes(Presentaci\'{o}, domini i persistència de dades) amb els següents patrons de disseny:
  \begin{itemize}
  \item Model-Vista-Controlador amb controlador frontal
  \item Capa de Servei
  \item Injecci\'{o} de depend\`{e}ncies
  \item Repositori de model de dades
  \item Capa de mapejat de dades
  \item View template
  \item Interfícies enriquides amb servei webs
  \end{itemize}

\subsection{Esquema del disseny}
La figura \ref{fig:dessignpatters} \'{e}s el diagrama general dels patrons que s'usaran per aquest projecte.
\begin{figure}[H]
  \includegraphics[scale=0.4]{img/design/IchnaeaPatterns.png}
  \caption{Patrons de disseny}
  \label{fig:dessignpatters}
\end{figure}

\subsection{Explicaci\'{o} del disseny}
El patró MVC,Model-Vista-Controlador, amb controlador frontal \'{e}s un disseny t\'{i}pic en les aplicacions web on:
\begin{itemize}
\item el \textbf{model} \'{e}s una representaci\'{o} de les dades.
\item la \textbf{vista} transforma el model a un format visible i llegible.
\item el \textbf{controlador frontal} rep totes les peticions i les re-dirigeix als controladors corresponents
\item el controlador se encarrega de processar les peticions especifiques
\end{itemize}
L'arquitectura \textbf{MVC} separa la capa de presentaci\'{o} de la l\`{o}gica de domini. La capa de presentaci\'{o} accedeix a la capa de domini mitjançant serveis, injectant depend\'{e}ncies. \\
La \textbf{injecci\'{o} de depend\'{e}ncies} \'{e}s un patr\'{o} a on es subministren objectes a una classe en lloc de ser la classe qui crea els objectes.\cite{dependency_injection} Les avantatges de usar DI(''dependency injection''):
\begin{itemize}
\item Codi m\'{e}s f\`{a}cil de mantenir, extendre o modificar
\item Desenvolupament guiat per proves (Test Driven Development o TDD en angl\'{e}s)
\item DI ens obliga a planejar una mica millor les nostres depend\`{e}ncies; decidim si una classe realment necessita d'un altre objecte per realitzar la seva funció.
\end{itemize}

En la \textbf{capa de serveis} cont\'{e} la l\'{o}gica de Ichnaea. Accedeixen a les dades mitjançant \textbf{repositoris} d'objectes. Els \textbf{repositoris} son mediadors entre el domini i les dades persistents. Els repositoris retornen entitats i/o collecions d'entitats de la l\'{ogica} de domini. \\

El \textbf{mapatge de dades} ORM(''Object Relational Mapping''), mapatge objecte-relacional, \'{e}s un patr\'{o} de disseny( encara que alguns enginyers els agrada dir que \'{e}s una tècnica de programaci\'{o} i a uns altres una tecnologia) que estableix una relaci\'{o} directe entre les entitats i la dades persistents.\cite{orm}

\section{Disseny d'interf\'{i}cies}
El disseny d'interfícies per les configuracions de les matrius es basa en funcionalitats enriquides\cite{ria}. Per dotar de funcionalitats a les interfícies webs s'utilitza peticions asíncrones. Per complir aquest requeriment s'ha de dissenyar una llibreria per atendre les peticions asíncrones i desenvolupar funcionalitats per atendre les respostes a aquestes peticions. A continuaci\'{o} es descriuen les interf\'{i}cies m\'{e}s complexes: les responsables de la configuraci\'{o} de les matrius.


\subsection{Interf\'{i}cie de configuraci\'{o} de matrius}
Les funcionalitats enriquides que han de complir:
\begin{itemize}
\item Carrega de conjunt de fitxers segons les variables.
\item Guardar la configuració de una columna: alias, variable i conjunt de fitxers.
\item Desplegar un calendari per seleccionar una data de la mostra.
\item Desplegar un selector obert de possibles valors de tots els orígens que estiguin especificats a les mostres.
\item Actualitzar el valor d'una mostra i d'una variable.
\item Permetre la mobilitat per la matriu fixant les capçaleres de les columnes i les files.
\item Adaptar-se a les dimensions de la pantalla.
\end{itemize}

A la figura \ref{fig:interfacematrixconf} es veu el disseny de la interfície de configuraci\'{o} de matrius.

\begin{figure}[H]
  \includegraphics[scale=0.6]{img/design/Interficiedeconfiguracio.png}
  \caption{Interfície de configuració de matrius}
  \label{fig:interfacematrixconf}
\end{figure}


\subsection{Interf\'{i}cie de configuraci\'{o} de matrius de predicció}
Les funcionalitats enriquides que han de complir:
\begin{itemize}
\item Guardar la configuració de una columna: alias i assignar-la a una columna entrenada.
\item Desplegar un calendari per seleccionar una data de la mostra.
\item Desplegar un selector obert de possibles valors de tots els orígens que estiguin especificats a les mostres.
\item Actualitzar el valor d'una mostra i d'una variable.
\item Adaptar-se a les dimensions de la pantalla.
\end{itemize}

A la figura \ref{fig:interfacematrixpredictionconf} es veu el disseny de la interfície de configuraci\'{o} de matrius de prediccions.

\begin{figure}[H]
  \includegraphics[scale=0.6]{img/design/Interficiedeconfiguraciopredi.png}
  \caption{Interfície de configuració de matrius de prediccions}
  \label{fig:interfacematrixpredictionconf}
\end{figure}
